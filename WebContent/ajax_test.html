<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- <html manifest="test.manifest">-->


<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>キャッシュ有効</title>
</head>


<body>
	<script type="text/javascript" src="js/jquery/jquery-2.1.4.min.js"></script>
	<script type="text/javascript" src="js/test_ajax.js"></script>
	<script type="text/javascript" src="js/indexeddb.js"></script>
	<script type="text/javascript" src="js/lib/kagedb.js"></script>
	<script type="text/javascript" src="js/browsersupport.js"></script>
	<script type="text/javascript" src="js/lib/operative.js"></script>
	<script type="text/javascript" src="js/lib/es6-promise.min.js"></script>
	<script type="text/javascript" src="js/json-xhr.js"></script>

	<noscript>
JavaScriptが無効になっています。
</noscript>
	<p>
		Ajaxのテスト <input type="button" onclick="javascript:getFriendList()"
			name="search" value="検索"><br /> <br />
	<p>
		ローカル参照のテスト <input id="localtest" type="button" name="DBFriend"
			value="ローカル検索"><br /> <br />
	<p>Indexed書き込み</p>
	<input id="dbtest" type="button" name="check" value="確認">
	<br />

	<p>IndexedDB検索テスト</p>
	<input id="gettest" type="button" name="check" value="確認">
	<br />

	<p>DB削除</p>
	<input id="dbdelete" type="button" name="check" value="確認">
	<br />

	<p>プロミス確認テスト</p>
	<input id="promisetest" type="button" name="check" value="確認">
	<br />


	<p>ワーカー確認テスト</p>
	<input id="workertest" type="button" name="check" value="確認">
	<br />

	<p>ブラウザ確認テスト</p>
	<input id="browsertest" type="button" name="check" value="確認">
	<br />

	<p>JSON取得のスタブのテスト</p>
	<input id="geturltest" type="button" name="check" value="確認">
	<input id="url" type="text" name="url">
	<br />



	<div id="friendList" style="width: 500px"></div>




	<script>
		$(window).load(function() {
			// なんやかんやと処理
			$('#dbdelete').click(function() {

				deleteDatabase("article");

			});

			$('#dbtest').click(function() {
				/**
				 * operativeを使うのはサーバと通信するときのみ
				 */

				for (var i = 0; i < 30 ; i++) {
					var article = {
								"article_id" : i,
								"acceptdate" : null,
								"created" : 1448330151000,
								"friendList" : [],
								"friend_id" : 11,
								"friend_user_id" : 2000,
								"friendlists" : [],
								"modified" : 1448330151000,
								"nickname" : "dummy7485"
					};
					var guid = 'aaa';
					updateArticle(article, guid);
				}
			});

			$('#gettest').click(function() {

// var guid = "aaa";
//
//
// var worker = new Worker('js/worker.js');
// worker.addEventListener('message', function(e) {
// // ここではconsoleでJSONデータを表示する
// console.log('DB data: ', e.data);
// }, false);
//
// // スレッドに何か送りたいときはpostの引数に設定
// worker.postMessage({'cmd': 'IDEAllArticles', 'guid' : guid});
				test('aaa');

			});

			$('#browsertest').click(function() {
				alert(isSupported(['chrome','opera','firefox','ie11', 'ie10']));
			});

			// なんやかんやと処理
			$('#localtest').click(function() {
				console.log("aaa");
			});

			$('#promisetest').click(function() {

				initPromise();
				// 実行例
				getArticleAsync(null).then(function (value) {
				    console.log(value);
				})['catch'](function(error){
				    console.error(error);
				});

			});

			$('#workertest').click(function() {
				if (window.Worker){
					initPromise();
					// これが疑似的なPromiseオブジェクト→Deferredオブジェクト
					var worker = new Worker('js/worker.js');
					worker.addEventListener('message', function(e) {
						// ここではconsoleでJSONデータを表示する
					  console.log('JSON data: ', e.data);
					}, true);

					console.log('ENABLE');
					// スレッドに何か送りたいときはpostの引数に設定
					worker.postMessage({'cmd': 'article'});

				} else {
					console.log('WORKER:DISABLE');
				}
			});

			$('#geturltest').click(function() {
				var url = $(':text[name = "url"]').val();



				var log = function(json){
					console.log(json);
				}

				// var param = {'user_name' = 'aaa'}
				getJSON(url, null, log);
			});

		})
	</script>

</body>
</html>